<%% content_for :title, "Payment ##{@payment.id}" %>

<div class="container-xl">
  <div class="flex items-center justify-between mb-8">
    <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-50">Payment #<%%= @payment.id %></h1>
    <%%= link_to admin_payments_path, class: "btn-ghost" do %>
      ‚Üê Back to Payments
    <%% end %>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Payment Details -->
    <div class="card bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700">
      <div class="card-body">
        <h2 class="text-lg font-semibold mb-4">Payment Information</h2>
        <dl class="space-y-3">
          <div>
            <dt class="text-sm text-muted">Amount</dt>
            <dd class="text-lg font-bold"><%%= number_to_currency(@payment.amount, unit: @payment.currency.upcase + ' ') %></dd>
          </div>
          <div>
            <dt class="text-sm text-muted">Status</dt>
            <dd>
              <span class="badge-<%%= case @payment.status
                    when 'paid' then 'success'
                    when 'failed' then 'danger'
                    when 'pending' then 'warning'
                    when 'processing' then 'info'
                    else 'neutral'
                    end %>">
                <%%= @payment.display_status %>
              </span>
            </dd>
          </div>
          <div>
            <dt class="text-sm text-muted">Created</dt>
            <dd><%%= @payment.created_at.strftime('%Y-%m-%d %H:%M:%S') %></dd>
          </div>
          <div>
            <dt class="text-sm text-muted">Updated</dt>
            <dd><%%= @payment.updated_at.strftime('%Y-%m-%d %H:%M:%S') %></dd>
          </div>
        </dl>
      </div>
    </div>

    <!-- Payable Information -->
    <div class="card bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700">
      <div class="card-body">
        <h2 class="text-lg font-semibold mb-4">Related <%%= @payment.payable_type %></h2>
        <dl class="space-y-3">
          <div>
            <dt class="text-sm text-muted">Type</dt>
            <dd><%%= @payment.payable_type %></dd>
          </div>
          <div>
            <dt class="text-sm text-muted">ID</dt>
            <dd>#<%%= @payment.payable_id %></dd>
          </div>
          <div>
            <dt class="text-sm text-muted">Description</dt>
            <dd><%%= @payment.product_description %></dd>
          </div>
<% if @auth -%>
          <%% if @payment.user %>
          <div>
            <dt class="text-sm text-muted">User</dt>
            <dd><%%= @payment.user.email %> (#<%%= @payment.user.id %>)</dd>
          </div>
          <%% end %>
<% end -%>
          <div>
            <dt class="text-sm text-muted">Customer Name</dt>
            <dd><%%= @payment.customer_name %></dd>
          </div>
          <div>
            <dt class="text-sm text-muted">Customer Email</dt>
            <dd><%%= @payment.customer_email %></dd>
          </div>
        </dl>
      </div>
    </div>

    <!-- Stripe Information -->
    <div class="card bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 lg:col-span-2">
      <div class="card-body">
        <h2 class="text-lg font-semibold mb-4">Stripe Information</h2>
        <dl class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <%% if @payment.stripe_checkout_session_id %>
          <div>
            <dt class="text-sm text-muted">Checkout Session ID</dt>
            <dd class="font-mono text-sm"><%%= @payment.stripe_checkout_session_id %></dd>
          </div>
          <%% end %>
          <%% if @payment.stripe_payment_intent_id %>
          <div>
            <dt class="text-sm text-muted">Payment Intent ID</dt>
            <dd class="font-mono text-sm"><%%= @payment.stripe_payment_intent_id %></dd>
          </div>
          <%% end %>
          <%% if @payment.payment_method %>
          <div>
            <dt class="text-sm text-muted">Payment Method</dt>
            <dd><%%= @payment.payment_method %></dd>
          </div>
          <%% end %>
          <%% if @payment.metadata.present? %>
          <div class="md:col-span-2">
            <dt class="text-sm text-muted">Metadata</dt>
            <dd class="mt-2">
              <pre class="bg-gray-100 p-3 rounded text-xs overflow-auto"><%%= JSON.pretty_generate(@payment.metadata) %></pre>
            </dd>
          </div>
          <%% end %>
        </dl>
      </div>
    </div>
  </div>
</div>
